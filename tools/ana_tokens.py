# 使用matplotlib分析token消耗
import matplotlib.pyplot as plt
import numpy as np

# 设置中文字体
plt.rcParams['font.sans-serif'] = ['SimHei']

# 从存档json中复制即可
tokens = [
    2467,
    3035,
    3149,
    3141,
    3217,
    3316,
    3153,
    3178,
    3248,
    3282,
    3305,
    3372,
    3366,
    3390,
    3372,
    3435,
    3403,
    3478,
    3522,
    3589,
    3465,
    3585,
    3606,
    3637,
    3678,
    4669,
    3259,
    3770,
    3727,
    3628,
    3647,
    3712,
    3740,
    3777,
    3869,
    3818,
    3795,
    3773,
    3888,
    4004,
    4053,
    4177,
    4121,
    4136,
    4137,
    4198,
    4270,
    4311,
    4285,
    4372,
    5808,
    3505,
    4034,
    4021,
    4105,
    4079,
    4228,
    4213,
    4145,
    4131,
    4236,
    4211,
    4296,
    4348,
    4473,
    4482,
    4384,
    4515,
    4473,
    4465,
    4539,
    4559,
    4591,
    4553,
    4602,
    5517,
    4117,
    4406,
    4427,
    4543,
    4554,
    4445,
    4596,
    4799,
    4716,
    4553,
    4588,
    4676,
    4631,
    4671,
    4693,
    4666,
    4807,
    4757,
    4858,
    4862,
    4979,
    4997,
    5078,
    6336,
    4403,
    4765,
    4830,
    4890,
    4730,
    4728,
    4875,
    4819,
    4857,
    4937
]

# 绘制折线图和拟合直线
# 绘制折线图
plt.plot(tokens, marker='o', linestyle='-', color='b')

# 拟合直线
x = range(len(tokens))
coeffs = np.polyfit(x, tokens, 1)
poly1d_fn = np.poly1d(coeffs)
plt.plot(x, poly1d_fn(x), '--r')

# 添加标题和标签
plt.title('token消耗折线图')
plt.xlabel('轮次')
plt.ylabel('token消耗')

# 添加拟合直线的表达式
plt.text(
    0.5, 0.9, f'拟合直线: y = {coeffs[0]:.4f}x + {coeffs[1]:.4f}', transform=plt.gca().transAxes)

# 显示图形
plt.show()
